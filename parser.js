const { ProtocolParser, parseIMEI, Data, GPRS } = require('complete-teltonika-parser')
const fastify = require('fastify')();

fastify.get('/getAVLData', async (request, reply) => {
    const packet = '00000000000001c88e030000017bdee6f4780100000000000000000000000000000000ef0011000800ef0100f00000150500450200010100030000fa0100fb00000300b5000000b60000004238f0000300f10000a41300c70000000000100066f4860002000b000000d177f3796c000e00000000054b73110001018300222b3030303030302e303030302b303030303030302e303030302b3030302e3030302f0000017bdee6d1500000000000000000000000000000000000fa0011000800ef0000f00000150000450200010100030000fa0100fb00000300b5000000b60000004238f4000300f10000000000c70000000000100066f4860002000b0000000000000000000e00000000000000000001018300222b3030303030302e303030302b303030303030302e303030302b3030302e3030302f000000f9cebb02380100000000000000000000000000000000fc0012000900ef0000f00000150000450200010100030000fa0000fb0000fc00000300b5000000b60000004238f7000300f10000000000c70000000000100066f4860002000b0000000000000000000e00000000000000000001018300222b3030303030302e303030302b303030303030302e303030302b3030302e3030302f03000019dc'
    let parsed = new ProtocolParser(packet)
    console.log(parsed.Content)
    let data, gprs;
    if (parsed.CodecType == "data sending") {
        data = parsed.Content
    } else {
        gprs = parsed.Content
    }

    const imei = parseIMEI('000F333532303933303839313638383231')
    console.log(imei)

    return parsed;
})

// Run the server!
const start = async () => {
    try {
        await fastify.listen(3000)
    } catch (err) {
        fastify.log.error(err)
        process.exit(1)
    }
}
start()
console.log("Server running at port 3000");
console.log("For testing request GET: /getAVLData");